## load packages
packages:
  - dplyr
  - magrittr
  - lubridate
  - tidyr
  - mvabund
  - ggplot2
  - lubridate
  - vegan
  - pryr
  - rmarkdown
  - vegan
  - readr
  - gridExtra
  - reshape2

## source in R functions
sources: 
  - R.scripts/FUNCTIONS_predator_diversity.R
  - R.scripts/FUNCTIONS_text.R
  - R.scripts/CALC_pd_experiment_models.R
  - R.scripts/FIGURE_themes.R
  - R.scripts/FIG1.R
  - R.scripts/FIG2.R
  - R.scripts/FIG3.R
  - R.scripts/DATA_summarize_randomization.R
  - R.scripts/DATA_prop_eaten.R
  - R.scripts/CALC_meta_dist.R
  
targets:
  all: 
    depends:
      - MS/predatordiversity.md
      - MS/predatordiversity.pdf
      - MS/TABLE1.md
      - MS/predatordiversity.docx
      - Figures/FIG_2.pdf

  # occurrance data -- metabolic capacity
  metabolic:
    command: read_csv("data/predator.cooccur.metabolic.txt")

  # feeding trial data
  feeding_trials:
    command: read_csv("data/reorganized.feeding.trial.data.csv")

  # phylogeny data
  nodeages:
    command: read_csv("data/nodeages.csv")
    
  # experiment results
  pd:
    command: read_csv("data/pd_exp_cleaned_data.csv")
    
    
  ## calculated from the previous stuff
  
  rand.means:
    command: read.csv("raw-data/predator.div.experiment/randomizations.group.means.csv")

  phylogenetic_distance:
    command: read_csv("data/phylogenetic_distance.csv")
    
  diet_predictions:
    command: read_csv("data/diet_predictions.csv")

## calculations
  ## distribution
  metabolic_distance:
    command: make_metabolic_dist_pianka(metabolic)

  metabolic_occur_phylo:
    command: left_join(metabolic_distance, phylogenetic_distance)

  ## feeding trials
  prop_eaten:
    command: calc_prop_eaten(feeding_trials)
    
  diet_overlap:
    command: make_prop_eaten_pianka(prop_eaten)
    
  diet_overlap_phylo:
    command: left_join(diet_overlap, phylogenetic_distance)
    
  

  summarize_randoms_phylo:
    command: make_randomization_summary(rand.means)

  pd_no_out:
    command: drop_outlier(pd)
    
  pd_experiment_phylo_dist:
    command: experiment_and_phylo(pd_no_out, phylogenetic_distance)
    
  modlist:
    command: make_modlist(pd_experiment_phylo_dist)
    
  distribution:
    command: metabolic_distribution()
  
  
  MS/TABLE1.md:
    depends:
      - modlist
    knitr: true
    
  MS/predatordiversity.md:
    depends: 
      - pd_no_out
      - feeding_trials
      - nodeages
      - metabolic
      - metabolic_occur_phylo
      - diet_overlap_phylo
      - MS/TABLE1.md
      - data/exper.Rdata
    knitr: true
    
#  MS/predatordiversity.pdf:
#    depends:
#      - Figures/FIG_1.pdf
#      - Figures/FIG_2.pdf
#      - Figures/FIG_3.pdf
#    command: render("MS/predatordiversity.md")

  experiment_phylo:
    command: pd_exper_responses(pd_no_out, phylogenetic_distance)
    
  Figures/FIG_1.png:
    command: make_fig_1(metabolic_occur_phylo, diet_overlap_phylo, experiment_phylo, diet_predictions)
    plot:
      width: 500
      height: 500
 
  Figures/FIG_2.png:
    command: make_fig_2(pd_no_out)
    plot:
      width: 500
      height: 500
      
  Figures/FIG_3.png:
    command: make_fig_3(summarize_randoms_phylo)
    plot:
      width: 500
      height: 500
      
      
  MS/predatordiversity.docx:
    depends:
      - Figures/FIG_1.png
      - Figures/FIG_2.png
      - Figures/FIG_3.png
    command: render("MS/predatordiversity.md", output_format = I("word_document"))
